<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Extintores</title>
<style>
/* -------------------- ESTILO GERAL --------------------- */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f3f4f6;
}

/* -------------------- TABS --------------------- */
.tabs {
  display: flex;
  background: #1f2937;
}
.tab {
  flex: 1;
  text-align: center;
  padding: 1rem;
  color: #fff;
  cursor: pointer;
  border-bottom: 3px solid transparent;
}
.tab.active {
  border-bottom: 3px solid #10b981;
  background: #111827;
}

.tab-content {
  display: none;
  padding: 1rem;
}
.tab-content.active {
  display: block;
}

/* -------------------- LISTAGEM EM USO --------------------- */
.item-uso {
  background: #fff;
  padding: 1rem;
  margin-bottom: .8rem;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  cursor: pointer;
  border-left: 5px solid #3b82f6;
}

.checkbox-uso {
  margin-right: 10px;
}

/* -------------------- ESTOQUE (CARDS) --------------------- */
.estoque-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1rem;
}

.card-estoque {
  background: #fff;
  padding: 1rem;
  border-radius: 6px;
  border-left: 5px solid #10b981;
}

.card-estoque h3 {
  margin-top: 0;
}

.btn {
  display: inline-block;
  padding: .4rem .8rem;
  background: #3b82f6;
  color: #fff;
  border-radius: 4px;
  margin-top: .5rem;
  cursor: pointer;
}

.btn.red {
  background: #ef4444;
}

.btn.green {
  background: #10b981;
}

.actions-bar {
  background: #fff;
  padding: .5rem 1rem;
  margin-bottom: 1rem;
  border-radius: 6px;
  display: none;
}

/* -------------------- MODAL --------------------- */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,.5);
  display: none;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  padding: 1rem;
  border-radius: 6px;
  width: 90%;
  max-width: 400px;
}
</style>
</head>
<body>

<!-- ------------------------------ TABS ------------------------------ -->
<div class="tabs">
  <div class="tab active" data-tab="uso">Em Uso</div>
  <div class="tab" data-tab="estoque">Estoque</div>
</div>

<!-- ------------------------------ AÇÕES EM LOTE ------------------------------ -->
<div id="actionsBar" class="actions-bar">
  <strong id="countSelecionados">0 selecionados</strong> —
  <span class="btn green" onclick="abrirModalPermuta(true)">Permutar</span>
  <span class="btn" onclick="mudarStatusLote()">Mudar Status</span>
  <span class="btn red" onclick="limparSelecao()">Cancelar</span>
</div>

<!-- ------------------------------ ABA "EM USO" ------------------------------ -->
<div id="tab-uso" class="tab-content active">

  <h2>Extintores em Uso</h2>

  <div id="listaUso"></div>

</div>

<!-- ------------------------------ ABA "ESTOQUE" ------------------------------ -->
<div id="tab-estoque" class="tab-content">

  <h2>Estoque por Tipo/Kg</h2>

  <div class="estoque-container" id="estoqueContainer"></div>

</div>

<!-- ------------------------------ MODAL PERMUTA ------------------------------ -->
<div id="modalPermuta" class="modal">
  <div class="modal-content">
    <h3>Permutar Extintores</h3>

    <p id="infoPermuta"></p>

    <label>Escolher categoria do estoque para retirar:</label>
    <select id="categoriaReposicao">
      <option>Operacional</option>
      <option>Não Operacional</option>
      <option>Em Manutenção</option>
      <option>Emprestado</option>
    </select>

    <br><br>
    <span class="btn green" onclick="confirmarPermuta()">Confirmar</span>
    <span class="btn red" onclick="fecharModal()">Cancelar</span>
  </div>
</div>

<script>
// ---------------- SIMULAÇÃO DE DADOS (depois substituímos pela planilha) -------------------
let emUso = [
  { id: 1, tipo: 'PQS 4kg', status: 'Operacional', local: 'Administração' },
  { id: 2, tipo: 'CO2 6kg', status: 'Não Operacional', local: 'Hangar' },
  { id: 3, tipo: 'PQS 4kg', status: 'Não Operacional', local: 'Sala Técnica' },
];

let estoque = {
  "PQS 4kg": {
    operacional: 18,
    naooperacional: 4,
    manutencao: 2,
    emprestado: 1
  },
  "CO2 6kg": {
    operacional: 5,
    naooperacional: 1,
    manutencao: 0,
    emprestado: 0
  }
};

let selecionados = []; 
let permutaLote = false;

// ---------------- FUNÇÃO PARA RENDERIZAR EXTINTORES EM USO -------------------
function renderUso() {
  let container = document.getElementById('listaUso');
  container.innerHTML = '';

  emUso.forEach(ext => {
    let isSelecionado = selecionados.includes(ext.id);

    container.innerHTML += `
      <div class="item-uso" onclick="toggleSelecionar(${ext.id})">
        <div>
          <input type="checkbox" class="checkbox-uso" ${isSelecionado ? 'checked' : ''}>
          <strong>${ext.tipo}</strong> – ${ext.local}<br>
          <small>Status: ${ext.status}</small>
        </div>
      </div>
    `;
  });
}
renderUso();

// ---------------- FUNÇÃO PARA RENDERIZAR ESTOQUE -------------------
function renderEstoque() {
  let container = document.getElementById("estoqueContainer");
  container.innerHTML = "";

  Object.keys(estoque).forEach(tipo => {
    let e = estoque[tipo];
    container.innerHTML += `
      <div class="card-estoque">
        <h3>${tipo}</h3>
        Operacionais: ${e.operacional}<br>
        Não operacionais: ${e.naooperacional}<br>
        Em manutenção: ${e.manutencao}<br>
        Emprestados: ${e.emprestado}<br>
        Total: ${e.operacional + e.naooperacional + e.manutencao + e.emprestado}
        <br><br>
        <span class="btn green" onclick="abrirModalPermuta(false, '${tipo}')">Permutar</span>
      </div>
    `;
  });
}
renderEstoque();

// ---------------- CONTROLE DE SELEÇÃO -------------------
function toggleSelecionar(id) {
  if (selecionados.includes(id)) {
    selecionados = selecionados.filter(i => i !== id);
  } else {
    selecionados.push(id);
  }
  atualizarActionsBar();
  renderUso();
}

function limparSelecao() {
  selecionados = [];
  atualizarActionsBar();
  renderUso();
}

function atualizarActionsBar() {
  let bar = document.getElementById("actionsBar");
  let count = document.getElementById("countSelecionados");

  if (selecionados.length > 0) {
    bar.style.display = "block";
    count.textContent = `${selecionados.length} selecionados`;
  } else {
    bar.style.display = "none";
  }
}

// ---------------- MODAL DE PERMUTA -------------------
function abrirModalPermuta(lote = false, tipoEstoque = null) {
  permutaLote = lote;
  window.tipoEstoque = tipoEstoque;

  document.getElementById("modalPermuta").style.display = "flex";

  if (lote) {
    document.getElementById("infoPermuta").innerText =
      `Você está permutando ${selecionados.length} extintor(es) em uso.`;
  } else {
    document.getElementById("infoPermuta").innerText =
      `Permutar extintor com estoque (${tipoEstoque}).`;
  }
}

function fecharModal() {
  document.getElementById("modalPermuta").style.display = "none";
}

// ---------------- CONFIRMAÇÃO DA PERMUTA -------------------
function confirmarPermuta() {
  fecharModal();

  let categoria = document.getElementById("categoriaReposicao").value;

  if (permutaLote) {
    // -------- PERMUTA EM LOTE (em uso → estoque) --------
    selecionados.forEach(id => {
      let ext = emUso.find(e => e.id === id);
      if (!ext) return;

      estoque[ext.tipo].operacional--;     // tira do estoque
      estoque[ext.tipo].naooperacional++;  // devolve como avariado
      ext.status = "Operacional";          // substituído
    });

  } else {
    // -------- PERMUTA INDIVIDUAL DIRETO NO CARD DO ESTOQUE --------
    if (!estoque[window.tipoEstoque]) return;

    estoque[window.tipoEstoque].operacional--;
    estoque[window.tipoEstoque].naooperacional++;
  }

  selecionados = [];
  atualizarActionsBar();
  renderUso();
  renderEstoque();
}

</script>

</body>
</html>