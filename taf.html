<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Indicadores TAF - SESCINC</title>
    
    <!-- Tailwind & Chart.js -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f8fafc; 
            color: #0f172a;
            -webkit-tap-highlight-color: transparent;
        }
        .ios-card {
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        .status-ready { background: #dcfce7; color: #166534; }
        .status-alert { background: #fee2e2; color: #991b1b; }
        
        /* Ocultar scrollbar mas manter funcionalidade */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        canvas { max-width: 100% !important; }
    </style>
</head>
<body class="pb-10">

    <!-- Cabeçalho de Identidade -->
    <header class="bg-[#1e293b] text-white pt-10 pb-6 px-6 rounded-b-[40px] shadow-xl">
        <div class="flex justify-between items-end">
            <div>
                <p class="text-blue-400 text-[10px] font-black uppercase tracking-[0.2em]">SESCINC JOI</p>
                <h1 class="text-2xl font-black">Indicadores TAF</h1>
            </div>
            <div class="bg-white/10 p-3 rounded-2xl backdrop-blur-md">
                <i data-lucide="shield-check" class="text-blue-400"></i>
            </div>
        </div>
    </header>

    <main class="px-4 -mt-4 space-y-4">
        
        <!-- Filtros de Navegação -->
        <div class="ios-card p-4 flex gap-3 overflow-x-auto no-scrollbar">
            <select id="filterEquipe" onchange="processData()" class="bg-gray-100 px-4 py-2 rounded-xl text-sm font-bold outline-none">
                <option value="TODAS">Todas Equipes</option>
                <option value="ALFA">ALFA</option>
                <option value="BRAVO">BRAVO</option>
                <option value="CHARLIE">CHARLIE</option>
                <option value="DELTA">DELTA</option>
            </select>
            <select id="filterMes" onchange="processData()" class="bg-gray-100 px-4 py-2 rounded-xl text-sm font-bold outline-none">
                <option value="dezembro/25">Dezembro/25</option>
                <option value="setembro/25">Setembro/25</option>
            </select>
        </div>

        <!-- Cards de Performance Geral -->
        <div class="grid grid-cols-2 gap-3">
            <div class="ios-card p-4">
                <p class="text-[10px] font-bold text-gray-400 uppercase">Média Geral</p>
                <div class="flex items-baseline gap-1">
                    <span id="statMedia" class="text-2xl font-black">0.0</span>
                    <span class="text-xs text-green-500 font-bold">▲</span>
                </div>
            </div>
            <div class="ios-card p-4">
                <p class="text-[10px] font-bold text-gray-400 uppercase">Aproveitamento</p>
                <div class="flex items-baseline gap-1">
                    <span id="statAproveitamento" class="text-2xl font-black">0%</span>
                </div>
            </div>
        </div>

        <!-- Análise Individual / Comparação -->
        <section class="ios-card p-5">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-sm">Evolução do Bombeiro</h3>
                <select id="selectBombeiro" onchange="updateIndividualChart()" class="text-blue-600 font-bold text-sm bg-blue-50 px-2 py-1 rounded-lg outline-none">
                    <!-- Populado via JS -->
                </select>
            </div>
            <div class="h-[200px] w-full">
                <canvas id="evolucaoChart"></canvas>
            </div>
            <div id="feedbackText" class="mt-4 text-[11px] text-gray-500 bg-gray-50 p-3 rounded-lg border-l-2 border-blue-500 italic">
                Selecione um bombeiro para ver a análise de desempenho.
            </div>
        </section>

        <!-- Ranking Detalhado -->
        <section class="ios-card overflow-hidden">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-sm">Ranking de Prontidão</h3>
                <i data-lucide="list-ordered" class="w-4 h-4 text-gray-400"></i>
            </div>
            <div class="divide-y divide-gray-50" id="rankingList">
                <!-- Itens injetados pelo JS -->
            </div>
        </section>

    </main>

    <script>
        // Dados extraídos do histórico da planilha
        const database = [
            {data: "setembro/25", nome: "IGOR VALÉRIO LAURIANO", equipe: "BRAVO", tempo: "0:01:50", nota: 10},
            {data: "dezembro/25", nome: "IGOR VALÉRIO LAURIANO", equipe: "BRAVO", tempo: "0:01:48", nota: 10},
            {data: "setembro/25", nome: "JOCIMAR TELMA", equipe: "BRAVO", tempo: "0:02:19", nota: 10},
            {data: "dezembro/25", nome: "JOCIMAR TELMA", equipe: "BRAVO", tempo: "0:02:31", nota: 10},
            {data: "setembro/25", nome: "MARCELO MOCENA", equipe: "DELTA", tempo: "0:01:43", nota: 10},
            {data: "dezembro/25", nome: "MARCELO MOCENA", equipe: "DELTA", tempo: "0:01:40", nota: 10},
            {data: "setembro/25", nome: "NELSON VITOR DOS SANTOS", equipe: "ALFA", tempo: "0:02:40", nota: 7},
            {data: "dezembro/25", nome: "NELSON VITOR DOS SANTOS", equipe: "ALFA", tempo: "0:02:22", nota: 8},
            {data: "setembro/25", nome: "WELLINGTON INACIO VILLAS BOAS MARQUES", equipe: "CHARLIE", tempo: "0:01:59", nota: 10},
            {data: "dezembro/25", nome: "WELLINGTON INACIO VILLAS BOAS MARQUES", equipe: "CHARLIE", tempo: "0:01:58", nota: 10},
            {data: "setembro/25", nome: "PATRICK LOPES TEODORO", equipe: "BRAVO", tempo: "0:02:18", nota: 9},
            {data: "dezembro/25", nome: "PATRICK LOPES TEODORO", equipe: "BRAVO", tempo: "0:02:25", nota: 9}
        ];

        let chartInstance = null;

        function init() {
            lucide.createIcons();
            populateSelect();
            processData();
        }

        function populateSelect() {
            const nomes = [...new Set(database.map(d => d.nome))].sort();
            const select = document.getElementById('selectBombeiro');
            nomes.forEach(nome => {
                const opt = new Option(nome, nome);
                select.add(opt);
            });
        }

        function processData() {
            const equipe = document.getElementById('filterEquipe').value;
            const mes = document.getElementById('filterMes').value;

            const filtered = database.filter(d => 
                (equipe === "TODAS" || d.equipe === equipe) && d.data === mes
            );

            // Estatísticas
            const media = (filtered.reduce((acc, curr) => acc + curr.nota, 0) / filtered.length).toFixed(1);
            const prontos = filtered.filter(d => d.nota >= 9).length;
            const perc = Math.round((prontos / filtered.length) * 100);

            document.getElementById('statMedia').innerText = isNaN(media) ? "0.0" : media;
            document.getElementById('statAproveitamento').innerText = (isNaN(perc) ? 0 : perc) + "%";

            renderRanking(filtered);
            updateIndividualChart();
        }

        function renderRanking(data) {
            const list = document.getElementById('rankingList');
            // Ordenar por nota e depois por tempo
            const sorted = data.sort((a, b) => b.nota - a.nota || a.tempo.localeCompare(b.tempo));
            
            list.innerHTML = sorted.map(item => `
                <div class="p-4 flex justify-between items-center">
                    <div class="flex flex-col">
                        <span class="text-[11px] font-black ${item.nota >= 9 ? 'text-green-600' : 'text-red-500'}">
                            ${item.nota >= 9 ? 'PRONTO PARA RESPOSTA' : 'REVISÃO NECESSÁRIA'}
                        </span>
                        <span class="text-sm font-bold text-gray-800">${item.nome}</span>
                        <span class="text-[10px] text-gray-400 font-bold">${item.equipe} | TEMPO: ${item.tempo}</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-xl font-black">${item.nota}</span>
                        <span class="text-[9px] font-bold text-gray-400">NOTA</span>
                    </div>
                </div>
            `).join('');
        }

        function updateIndividualChart() {
            const nome = document.getElementById('selectBombeiro').value;
            const historico = database.filter(d => d.nome === nome).sort((a,b) => a.data.includes('setembro') ? -1 : 1);
            
            const ctx = document.getElementById('evolucaoChart').getContext('2d');
            
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Set/25', 'Dez/25'],
                    datasets: [{
                        label: 'Desempenho (Nota)',
                        data: historico.map(d => d.nota),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: '#fff',
                        pointBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 0, max: 10, ticks: { stepSize: 2 } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Lógica de Feedback
            const feedback = document.getElementById('feedbackText');
            if (historico.length >= 2) {
                const diffNota = historico[1].nota - historico[0].nota;
                const tempo1 = historico[0].tempo;
                const tempo2 = historico[1].tempo;
                
                let msg = `Bombeiro ${nome.split(' ')[0]}: `;
                if(diffNota > 0) msg += "Evolução positiva na nota. ";
                else if(diffNota < 0) msg += "Atenção: Queda na nota técnica. ";
                else msg += "Manteve a nota. ";

                msg += `Tempo anterior: ${tempo1} | Atual: ${tempo2}.`;
                feedback.innerText = msg;
            }
        }

        window.onload = init;
    </script>
</body>
</html>

